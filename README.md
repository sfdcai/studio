# MediaFlow - Local Media Processor

This project provides a simple yet powerful tool for processing a local media library. It uses a web interface to monitor and trigger backend scripts that handle tasks like video and image compression based on the age of the files.

## Features ✨

*   **Web UI Dashboard:** A modern Next.js interface to view file stats, see logs, and monitor the processing queue.
*   **Centralized Configuration:** Manage all backend script settings directly from the web UI.
*   **Database-Driven:** Uses an SQLite database as the single source of truth, tracking every file, its metadata, and processing status.
*   **Bulletproof Deduplication:** Calculates a unique hash for each file to prevent duplicates from ever entering your archive.
*   **Smart, Tiered Compression:** Automatically applies different levels of compression to images and videos based on their age.

---

## Installation and Setup

### 1. Prerequisites

*   A Linux server (physical or virtual). This guide is tailored for **Ubuntu 22.04 LTS**.
*   `git` installed on the server to clone this repository.

### 2. Run the Backend Environment Setup Script
Execute the `setup_media_server.sh` script. This script installs all required software (`ffmpeg`, `imagemagick`, etc.) and initializes the database.
```bash
# Clone the repository first if you haven't already
# git clone <your-repository-url>
# cd your-repository-folder

chmod +x setup_media_server.sh
sudo ./setup_media_server.sh
```

### 3. Deploy the Web UI
To set up the Web UI on a fresh server, you can use the following command. It downloads the deployment script from your repository, makes it executable, and starts the automated setup process.

```bash
# Ensure you are in the directory where you want to clone the project
wget https://raw.githubusercontent.com/<your_github_user>/<your_repo>/main/deploy_ui.sh
chmod +x deploy_ui.sh
sudo ./deploy_ui.sh
```
The script will handle system updates, Node.js installation, cloning the repository, building the app, and running it with `pm2`. It will prompt you once to add the server's SSH key to your GitHub repository as a "Deploy Key". Follow the on-screen instructions.

### 4. Configure the System via the Web UI
Once the script is finished, the application will be running.
*   **Access the UI:** Open your browser to `http://<your_server_ip>:3000`.
*   **Navigate to Settings:** Go to the "Settings" page in the application.
*   **Fill Out All Fields:** Carefully fill out all the settings, especially the "Backend Paths". The paths you enter here **must** match the directories available on your server.
*   **Save Settings:** Click "Save Storage & Backend Settings". This will create the `config.conf` file in your project directory that the backend scripts need to run.

### 5. Start Processing
*   Place your media files into the **Staging Directory** you configured in the UI.
*   Navigate to the **Dashboard** and click **Run Processing** to start converting your files.

---

## Project Structure

The entire application is installed in `/root/mediaflow/` on your server.

```
/root/mediaflow/
├── src/                      # Source code for the Next.js Web UI
│
├── config.conf               # !!! Auto-generated by the UI for the backend scripts.
├── settings.json             # !!! The master file where the UI saves your settings.
│
├── deploy_ui.sh              # The main script to deploy or restart the Web UI.
├── run_all.sh                # The master script to run the full backend processing job.
├── process_media.sh          # The script that handles media compression, archiving, etc.
├── setup_media_server.sh     # The script for initial server setup.
│
├── media_library.sqlite      # The default location for the SQLite database file.
└── package.json              # Defines the project and its Node.js dependencies.
```
